// --------------------------------------------------------------------
// Copyright (c) 2024 Alexandre Bento Freire. All rights reserved.
// Licensed under the MIT license
// --------------------------------------------------------------------
// Version: 1.2.0
var x=console.debug,k=()=>!1,R=t=>{},g=(t=void 0)=>0,p=()=>{},m=()=>{},S=t=>{x(t)},N=t=>{x=t||x};var A={result:"{name}:`{value}`",input:"{name}:`{value}`",thread:"{id}: ",sep:" | ",new_line:!0},F=A,l={},b={},y=!0,O=({stream:t=void 0,multithreading:s=!1,format:a=A,enabled:r=!0}={})=>{p(),N(t),R(s),F=a,l={},b={},y=r,m()},j=(t=void 0,s=void 0)=>{y&&(p(),b[g(s)]=t||`t${Object.keys(b).length}`,m())},B=(t,s)=>{if(!y)return t;let{name:a=void 0,allow:r=void 0,level:u=0}=s||{};p();let d=g();for(l[d]||(l[d]=[{index__:0,meta__:["meta__","index__"]}]);l[d].length<=u;)l[d].push({index__:0,meta__:["meta__","index__"]});let _=l[d][u],n=_.index__,i=_.meta__.length,f=typeof a=="function"?a(n,Object.keys(_).length-i,t):a||`i${Object.keys(_).length-i}`,e=t,o=r;try{typeof r=="function"&&(o=r(n,f,t),typeof o!="boolean"&&(e=o,o=!0))}finally{(o===void 0||o)&&(_[f]=e),_.index__=n+1,m()}return t},L=(t,s={})=>{if(!y)return t;let{name:a="_",allow:r=void 0,before:u=void 0,after:d=void 0,inputs:_=void 0,format:n=void 0}=s||{};p();let i=g(),f=l[i]||[{}],e={...f[f.length-1],..._||{}};e.thread_id__=i,e.input_count__=e.index__||0,e.allow__=!0,e.meta__=[...e.meta__||["meta__"],"allow__","allow_input_count__","input_count__","thread_id__",a],e[a]=t,delete e.index__,e.meta__=e.meta__.filter(o=>o!=="index__"),e.allow_input_count__=Object.keys(e).length-e.meta__.length+1;try{if(typeof r=="function"&&(r=r(e),typeof r!="boolean"&&(e[a]=r,r=!0)),r!==!1){n=n||F;let o="";k()&&n.thread&&(o+=n.thread.replace("{id}",b[i]||`${i}`));let w=(c,I,h)=>c.replace("{name}",I).replace("{value}",typeof h=="object"?JSON.stringify(h):h);if(n.input)for(let c in e)e.meta__.includes(c)||(o+=w(n.input,c,e[c])+(n.sep||""));n.result&&(o+=w(n.result,a,e[a])),e.meta__+=["output__"],e.output__=o,(u===void 0||u(e))&&S(e.output__+(n.new_line?`
`:""))}else e.allow__=!1;d&&d(e)}finally{l[i]&&(l[i].pop(),l[i].length===0&&delete l[i]),m()}return t};export{A as DEFAULT_FORMAT,B as c__,L as d__,O as init__,j as t__};
//# sourceMappingURL=jstracetoix.mjs.map
