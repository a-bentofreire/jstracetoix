// --------------------------------------------------------------------
// Copyright (c) 2024 Alexandre Bento Freire. All rights reserved.
// Licensed under the MIT license
// --------------------------------------------------------------------
// Version: 1.2.0
"use strict";var x=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var O=Object.getOwnPropertyNames;var j=Object.prototype.hasOwnProperty;var E=(e,n)=>{for(var r in n)x(e,r,{get:n[r],enumerable:!0})},v=(e,n,r,a)=>{if(n&&typeof n=="object"||typeof n=="function")for(let l of O(n))!j.call(e,l)&&l!==r&&x(e,l,{get:()=>n[l],enumerable:!(a=M(n,l))||a.enumerable});return e};var $=e=>v(x({},"__esModule",{value:!0}),e);var U={};E(U,{DEFAULT_FORMAT:()=>A,c__:()=>J,d__:()=>P,init__:()=>W,t__:()=>D});module.exports=$(U);var R=require("worker_threads"),q=new SharedArrayBuffer(4),I=new Int32Array(q),y=!1,k=process.stdout,B=()=>y,N=e=>{y=e},F=e=>{k=e||k},T=e=>{k.write(e)},g=(e=void 0)=>e||R.threadId,m=()=>{for(;y&&Atomics.compareExchange(I,0,0,1)!==0;);},p=()=>{y&&Atomics.store(I,0,0)};var A={result:"{name}:`{value}`",input:"{name}:`{value}`",thread:"{id}: ",sep:" | ",new_line:!0},C=A,_={},h={},b=!0,W=({stream:e=void 0,multithreading:n=!1,format:r=A,enabled:a=!0}={})=>{m(),F(e),N(n),C=r,_={},h={},b=a,p()},D=(e=void 0,n=void 0)=>{b&&(m(),h[g(n)]=e||`t${Object.keys(h).length}`,p())},J=(e,n)=>{if(!b)return e;let{name:r=void 0,allow:a=void 0,level:l=0}=n||{};m();let s=g();for(_[s]||(_[s]=[{index__:0,meta__:["meta__","index__"]}]);_[s].length<=l;)_[s].push({index__:0,meta__:["meta__","index__"]});let u=_[s][l],o=u.index__,d=u.meta__.length,f=typeof r=="function"?r(o,Object.keys(u).length-d,e):r||`i${Object.keys(u).length-d}`,t=e,i=a;try{typeof a=="function"&&(i=a(o,f,e),typeof i!="boolean"&&(t=i,i=!0))}finally{(i===void 0||i)&&(u[f]=t),u.index__=o+1,p()}return e},P=(e,n={})=>{if(!b)return e;let{name:r="_",allow:a=void 0,before:l=void 0,after:s=void 0,inputs:u=void 0,format:o=void 0}=n||{};m();let d=g(),f=_[d]||[{}],t={...f[f.length-1],...u||{}};t.thread_id__=d,t.input_count__=t.index__||0,t.allow__=!0,t.meta__=[...t.meta__||["meta__"],"allow__","allow_input_count__","input_count__","thread_id__",r],t[r]=e,delete t.index__,t.meta__=t.meta__.filter(i=>i!=="index__"),t.allow_input_count__=Object.keys(t).length-t.meta__.length+1;try{if(typeof a=="function"&&(a=a(t),typeof a!="boolean"&&(t[r]=a,a=!0)),a!==!1){o=o||C;let i="";B()&&o.thread&&(i+=o.thread.replace("{id}",h[d]||`${d}`));let S=(c,L,w)=>c.replace("{name}",L).replace("{value}",typeof w=="object"?JSON.stringify(w):w);if(o.input)for(let c in t)t.meta__.includes(c)||(i+=S(o.input,c,t[c])+(o.sep||""));o.result&&(i+=S(o.result,r,t[r])),t.meta__+=["output__"],t.output__=i,(l===void 0||l(t))&&T(t.output__+(o.new_line?`
`:""))}else t.allow__=!1;s&&s(t)}finally{_[d]&&(_[d].pop(),_[d].length===0&&delete _[d]),p()}return e};0&&(module.exports={DEFAULT_FORMAT,c__,d__,init__,t__});
//# sourceMappingURL=jstracetoix.cjs.map
